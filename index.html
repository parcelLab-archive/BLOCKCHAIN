<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>CryptoZombies front-end</title>
  <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script language="javascript" type="text/javascript" src="web3.js"></script>
  <script language="javascript" type="text/javascript" src="bin/CallingContract.abi"></script>
</head>

<body>

  <input id="whatCall" type="text" />

  <div id="allCalls"></div>

  <script>
    var calledItContract;
    var userAccount;

    function startApp() {
      var calledItContractAddress = "0x7e26024f100dbbc9781f14e2d4e5cba49a3f9081";
      calledItContract = web3js.eth.contract([{ "constant": false, "inputs": [{ "name": "_fee", "type": "uint256" }], "name": "setCallingFee", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [], "name": "withdraw", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "_description", "type": "string" }], "name": "callIt", "outputs": [{ "name": "callID", "type": "uint256" }], "payable": true, "stateMutability": "payable", "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "uint256" }], "name": "calls", "outputs": [{ "name": "description", "type": "string" }, { "name": "caller", "type": "address" }, { "name": "createdDate", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "previousOwner", "type": "address" }, { "indexed": true, "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }]).at(calledItContractAddress);

      var accountInterval = setInterval(function () {
        if (web3.eth.accounts[0] !== userAccount) {
          userAccount = web3.eth.accounts[0];
          // Call a function to update the UI with the new account


        }

        getAllCalls(id, function (zero) {

          var id = $("#whatCall").val();
          $('#allCalls').html(`Call: ${zero[0]}<br />Caller: ${zero[1]}<br />When: ${zero[2]}`);

        })

      }, 100);
    }

    function displayAllCalls(calls) {
      $("#allCalls").empty();
    }

    // Start here

    function getAllCalls(id, callback) {
      calledItContract.calls(id, function (err, res) {
        if (err) callback(['n/a', 'n/a', 'n/a'])
        else callback(res)
      })
    }

    window.addEventListener('load', function () {

      if (typeof web3 !== 'undefined') {
        web3js = new Web3(web3.currentProvider);
      } else {
        // Handle the case where the user doesn't have Metamask installed
        // Probably show them a message prompting them to install Metamask
      }

      startApp()

    })
  </script>
</body>

</html>